<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard | Linux CTF</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0c0f0d;
      --panel:#101412;
      --ink:#03f484;
      --ink-dim:#03f484a6;
      --ink-faint:#03f4845c;
      --danger:#ff4d4d;
      --muted:#93e9c7;
      --radius:14px;
      --glow:0 0 12px var(--ink-faint);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;display:flex;min-height:100vh;
      background: radial-gradient(1200px 600px at 20% -10%, #0e1a14 2%, var(--bg) 55%) fixed;
      color:var(--ink);font-family:"Share Tech Mono", monospace;
    }

    /* Sidebar */
    .sidebar{
      width:280px;min-width:260px;height:100vh;position:sticky;top:0;
      background:var(--panel);padding:22px 20px 90px;overflow-y:auto;
      box-shadow:3px 0 18px #03f48440;
    }
    .brand{font-size:22px;letter-spacing:1px;margin:0 0 18px}
    .nav a{
      display:block;padding:8px 0;text-decoration:none;color:var(--ink);
      opacity:.9;transition:opacity .15s, text-shadow .15s;
    }
    .nav a:hover{opacity:1;text-shadow:0 0 10px var(--ink)}
    .divider{
      height:1px;margin:14px 0;border:0;background:linear-gradient(90deg,transparent, var(--ink-faint), transparent);
    }

    /* Quick panels */
    .quick{background:#0b0f0d;border:1px solid #0f221a;border-radius:12px;padding:14px;margin-top:12px;box-shadow:var(--glow)}
    .quick h3{margin:0 0 10px;font-size:16px;color:var(--muted)}
    .meta{font-size:12px;color:var(--ink-dim);margin-top:6px}
    .k{font-size:13px;margin-top:2px;word-break:break-all}
    .copy-row{display:flex;align-items:center;gap:8px;margin-top:10px}
    .ghost-btn{
      padding:8px 12px;border:1px solid var(--ink);background:transparent;color:var(--ink);
      border-radius:10px;cursor:pointer;transition:background .15s,color .15s
    }
    .ghost-btn:hover{background:var(--ink);color:#04130d}
    #copy-note{font-size:12px;color:var(--ink-dim);opacity:0;transition:opacity .2s}

    /* Logout */
    .logout{position:absolute;left:20px;right:20px;bottom:20px}
    .btn{
      display:inline-block;padding:10px 14px;border:1px solid var(--danger);color:var(--danger);
      background:transparent;width:100%;cursor:pointer;border-radius:10px;transition:background .15s
    }
    .btn:hover{background:rgba(255,77,77,.1)}

    /* Main content */
    .content{flex:1;max-width:1100px;margin:0 auto;padding:36px 42px 80px}
    .header{display:flex;align-items:center;gap:18px;flex-wrap:wrap;margin-bottom:22px}
    .title{margin:0;font-size:26px}
    .progress{
      flex:1;min-width:260px;height:10px;border:1px solid var(--ink);border-radius:999px;position:relative;
      background:#0a0d0c;box-shadow:inset 0 0 10px #000
    }
    .bar{
      position:absolute;left:0;top:0;bottom:0;width:0;border-radius:999px;
      background:linear-gradient(90deg,#0bff92,#03f484);box-shadow:0 0 14px var(--ink-faint)
    }
    .progress small{position:absolute;right:10px;top:-22px;color:var(--ink-dim)}

    /* Grid of levels */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px}
    .card{
      position:relative;overflow:hidden;background:var(--panel);
      border:1px solid #0f221a;border-radius:var(--radius);padding:18px;box-shadow:var(--glow)
    }
    .card.current{outline:1px dashed var(--ink);box-shadow:0 0 18px var(--ink-faint)}
    .card.completed{opacity:.9}
    .badge{
      display:inline-block;font-size:12px;border:1px solid var(--ink);padding:2px 8px;border-radius:999px;opacity:.85
    }
    .title-sm{margin:8px 0 6px 0;font-size:18px}
    .desc{color:var(--ink-dim);min-height:60px}
    .hint{font-size:12px;color:var(--ink-dim);margin-top:8px}
    .tick{color:#86ffb7}

    /* Lock overlay (keeps layout but blocks interaction) */
    .locked{pointer-events:none}
    .locked::after{
      content:"LOCKED";position:absolute;inset:0;display:grid;place-items:center;
      background:rgba(0,0,0,.55);backdrop-filter:blur(1.5px);color:#9ef7cf;
      border-top:1px solid #0f221a;letter-spacing:4px
    }

    /* Inputs */
    .flag-row{display:flex;gap:8px;margin-top:10px}
    input[type=text]{
      flex:1;padding:8px;border:1px solid var(--ink);border-radius:8px;
      background:#020403;color:var(--ink);font-family:inherit
    }
    .submit{
      border:1px solid var(--ink);background:transparent;color:var(--ink);
      padding:8px 14px;border-radius:8px;cursor:pointer;transition:background .15s,color .15s
    }
    .submit:hover{background:var(--ink);color:#04130d}

    /* Small helpers */
    .subtle{color:var(--ink-dim);font-size:12px;line-height:1.45}
    @media (max-width: 880px){
      .sidebar{width:250px}
      .content{padding:26px 22px 60px}
    }
  </style>

  <script>
    function copyToClipboard(text){
      navigator.clipboard.writeText(text).then(()=>{
        const note = document.getElementById('copy-note');
        if(note){ note.style.opacity = '1'; setTimeout(()=>note.style.opacity='0', 1200); }
      });
    }
    function submitFlag(level){
      const input = document.getElementById(`flag-input-${level}`);
      const flag = (input?.value || "").trim();
      if(!flag){ alert("Please enter a flag."); return; }
      fetch("/submit-flag",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ level, flag })
      })
      .then(r=>r.json())
      .then(d=>{
        alert(d.message || "Submitted");
        if(d.success){ location.reload(); }
      })
      .catch(()=>alert("Network error"));
    }
  </script>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" aria-label="Sidebar">
    <h1 class="brand">Linux CTF</h1>
    <nav class="nav" aria-label="Primary">
      <a href="/dashboard">Modules</a>
      <a href="/profile">Profile</a>
      <a href="/settings">Settings</a>
    </nav>

    <hr class="divider"/>

    <!-- QUICK START -->
    <section class="quick" aria-labelledby="qs-title">
      <h3 id="qs-title">Quick Start</h3>

      <div class="meta">Host</div>
      <div class="k">linux-ctf.matrixploit.com</div>

      <div class="meta">SSH Port</div>
      <div class="k">42424</div>

      <div class="meta">First User</div>
      <div class="k">easy-matrix0</div>

      <div class="meta">Password for easy-matrix0</div>
      <div class="k">GCL{7hi5_1s_a_Fl4g}</div>

      <div class="copy-row">
        <button class="ghost-btn"
                onclick="copyToClipboard('ssh -p 42424 easy-matrix0@linux-ctf.matrixploit.com')">
          Copy SSH command
        </button>
        <span id="copy-note" role="status" aria-live="polite">Copied!</span>
      </div>

      <p class="subtle" style="margin-top:10px">
        Flags look like <b>GCL{...}</b>. Submit each flag below to record progress.
        The flag inside <b>easy-matrix0</b> is <b>GCL{L37s_B3g3n_7h3_G4m3}</b> — it becomes
        the password for <b>easy-matrix1</b>.
      </p>
    </section>

    <section class="quick" style="margin-top:14px" aria-labelledby="how-title">
      <h3 id="how-title">How it works</h3>
      <ol class="subtle" style="margin-left:14px">
        <li>SSH into the current user (start at <b>easy-matrix0</b>).</li>
        <li>Complete the task and find the flag <b>GCL{...}</b>.</li>
        <li>Submit the flag here to unlock the next level.</li>
        <li>Use that flag as the <b>password</b> to SSH into the next user.</li>
      </ol>
      <p class="subtle">Environment is restricted (rbash). Stay in your home directory—no privilege escalation required.</p>
    </section>

    <form class="logout" action="/logout" method="POST">
      <button class="btn" type="submit">Logout</button>
    </form>
  </aside>

  <!-- Main content -->
  <main class="content">
    {% set total = 10 %}
    {% set progress = (last_completed_level if last_completed_level <= total else total) %}
    <header class="header">
      <h2 class="title">Easy Module</h2>
      <div class="progress" aria-label="progress">
        <div class="bar" style="width: {{ (progress/total*100) }}%"></div>
        <small>{{ progress }}/{{ total }} completed</small>
      </div>
    </header>

    {# Level blurbs #}
    {% set levels = [
      {'n':1,  'name':'Dot & Hidden Paths',     'blurb':'Explore dot files and hidden directories. Find where secrets like .flag may hide.'},
      {'n':2,  'name':'Dash-Led Filenames',     'blurb':'Handle files whose names begin with a dash (e.g., \"-vault\"). Learn safe ways to reference them.'},
      {'n':3,  'name':'Base64 Decoding Basics', 'blurb':'A file looks like gibberish. Decode the content correctly to reveal the flag.'},
      {'n':4,  'name':'Robots Recon',           'blurb':'Robots can hide things… Locate and read the file that hints where the treasure lies.'},
      {'n':5,  'name':'Tabs in Filenames',      'blurb':'Mind the whitespace! Discover and open a file whose name contains a tab character.'},
      {'n':6,  'name':'Grep the Needle',        'blurb':'Search text efficiently with grep. Narrow down lines that matter and extract the flag.'},
      {'n':7,  'name':'Case‑Sensitive Matches', 'blurb':'When case matters, your searches must too. Match the correct case to pass.'},
      {'n':8,  'name':'Regex Mini‑Trial',       'blurb':'Write a simple regular expression to capture the flag from structured text.'},
      {'n':9,  'name':'Flag in the Paragraph',  'blurb':'It’s buried in prose. Use command‑line tools to isolate and read it cleanly.'},
      {'n':10, 'name':'Unpack the Chest',       'blurb':'A compressed archive guards the prize. Inspect, extract, and read the final flag.'}
    ] %}

    <section class="grid" aria-label="Easy levels">
      {% for L in levels %}
        {% set i = L.n %}
        {% set is_current = (i == last_completed_level + 1) %}
        {% set is_done = (i <= last_completed_level) %}
        <article class="card{% if is_current %} current{% endif %}{% if not is_current and not is_done %} locked{% endif %}{% if is_done %} completed{% endif %}">
          <span class="badge">Level {{ i }}</span>
          <h3 class="title-sm">{{ L.name }}</h3>
          <p class="desc">{{ L.blurb }}</p>

          {% if is_current %}
            <div class="flag-row">
              <input id="flag-input-{{ i }}" type="text" placeholder="Enter flag e.g. GCL{...}" autocomplete="off" spellcheck="false">
              <button class="submit" onclick="submitFlag({{ i }})">Submit</button>
            </div>
            <p class="hint">Tip: your current user’s flag becomes the password for the next SSH user.</p>
          {% elif is_done %}
            <p class="hint"><span class="tick">✅ Completed</span></p>
          {% else %}
            <p class="hint">Complete previous levels to unlock.</p>
          {% endif %}
        </article>
      {% endfor %}
    </section>

    <!-- Future modules -->
    <section style="margin-top:34px">
      <h2 class="title" style="font-size:22px">Hard Module</h2>
      <div class="card locked"><p class="desc">Locked — finish all Easy levels to unlock.</p></div>
    </section>

    <section style="margin-top:18px">
      <h2 class="title" style="font-size:22px">Advanced Module</h2>
      <div class="card locked"><p class="desc">Locked — complete Hard module first.</p></div>
    </section>
  </main>
</body>
</html>